<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>NBA Streak Picker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1100px;
            margin: 20px auto;
            background: #0f172a;
            color: #e5e7eb;
        }
        h1, h2, h3 {
            color: #facc15;
        }
        a {
            color: #93c5fd;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .card {
            background: #111827;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }
        th, td {
            padding: 6px 8px;
            border-bottom: 1px solid #1f2937;
        }
        th {
            text-align: left;
            color: #9ca3af;
        }
        .error {
            color: #fecaca;
        }
        .message {
            color: #bbf7d0;
        }
        button {
            padding: 6px 10px;
            border-radius: 4px;
            border: none;
            margin-top: 4px;
            background: #22c55e;
            color: #022c22;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background: #16a34a;
        }
        .btn-small {
            font-size: 12px;
            padding: 3px 8px;
            margin: 0;
        }
        .btn-disabled {
            background: #4b5563;
            color: #9ca3af;
            cursor: default;
        }
        .lauf-pill {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            margin-right: 4px;
            margin-bottom: 4px;
            background: #1f2937;
        }
        .lauf-active {
            background: #4ade80;
            color: #022c22;
            font-weight: bold;
        }

        /* Kalender */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .calendar-nav a {
            margin: 0 4px;
        }
        .calendar {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            table-layout: fixed;
        }
        .calendar th, .calendar td {
            text-align: center;
            padding: 4px;
            border: 1px solid #1f2937;
            font-size: 12px;
        }
        .calendar th {
            background: #020617;
        }
        .calendar a {
            display: block;
            width: 100%;
            height: 100%;
            color: inherit;
            text-decoration: none;
            padding: 4px 0;
        }
        .calendar a:hover {
            text-decoration: underline;
        }

        .day-picked { background: #14532d; }
        .day-b2b { background: #7f1d1d; }
        .day-future { background: #78350f; }
        .day-empty { background: #374151; }
        .day-other {
            background: #111827;
            color: #4b5563;
        }

        .legend {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 8px;
        }
        .legend span {
            display: inline-block;
            margin-right: 12px;
        }
        .legend-box {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            margin-right: 4px;
        }

        /* Matchups */
        .matchup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }
        .matchup-card {
            background: #020617;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        }
        .matchup-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .matchup-team {
            flex: 1;
            text-align: center;
        }
        .matchup-team img {
            max-width: 60px;
            max-height: 60px;
            display: block;
            margin: 0 auto 6px;
        }
        .team-placeholder {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            margin: 0 auto 6px;
            padding: 4px;
            text-align: center;
        }
        .team-name {
            font-size: 12px;
            margin-bottom: 4px;
        }
        .at {
            width: 30px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        /* Team-Status */
        .team-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        .team-status-card {
            background: #020617;
            border-radius: 8px;
            padding: 6px;
            text-align: center;
            font-size: 11px;
        }
        .team-status-card img {
            max-width: 40px;
            max-height: 40px;
            display: block;
            margin: 0 auto 4px;
        }
        .team-used { background: #7f1d1d; }
        .team-free { background: #064e3b; }
    </style>
</head>

<body>
    <h1>NBA Streak Picker üèÄ</h1>
    <p>Aktueller Spieltag: {{ current_day }}</p>

    <!-- Kalender -->
    <div class="card">
        <div class="calendar-header">
            <h2>Monats√ºbersicht ‚Äì {{ month_label }}</h2>
            <div class="calendar-nav">
                <a href="{{ url_for('index', run=current_run, day=prev_month_day) }}">¬´ Vormonat</a>
                |
                <a href="{{ url_for('index', run=current_run, day=next_month_day) }}">N√§chster Monat ¬ª</a>
            </div>
        </div>

        <table class="calendar">
            <tr>
                <th>Mo</th><th>Di</th><th>Mi</th><th>Do</th><th>Fr</th><th>Sa</th><th>So</th>
            </tr>
            {% for week in month_weeks %}
                <tr>
                    {% for d in week %}
                        <td class="{{ d.css_class }}">
                            <a href="{{ url_for('index', run=current_run, day=d.date) }}">
                                {{ d.day }}
                            </a>
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>

        <div class="legend">
            <span><span class="legend-box" style="background:#14532d;"></span>Pick gemacht</span>
            <span><span class="legend-box" style="background:#7f1d1d;"></span>Back-to-back-Pick</span>
            <span><span class="legend-box" style="background:#78350f;"></span>Zuk√ºnftiger Tag ohne Pick</span>
            <span><span class="legend-box" style="background:#374151;"></span>Vergangener Tag ohne Pick</span>
            <span><span class="legend-box" style="background:#111827;"></span>Anderer Monat</span>
        </div>
    </div>

    <!-- Spieltag-Navigation -->
    <div class="card">
        <h2>Spieltag-Navigation</h2>
        <p>
            <a href="{{ url_for('index', run=current_run, day=prev_day) }}">‚¨Ö Vorheriger Tag</a>
            &nbsp;&nbsp;|&nbsp;&nbsp;
            <a href="{{ url_for('index', run=current_run, day=next_day) }}">N√§chster Tag ‚û°</a>
        </p>
    </div>

    <!-- L√§ufe -->
    <div class="card">
        <h2>L√§ufe</h2>
        <p>
            {% for r in runs %}
                {% if r == current_run %}
                    <span class="lauf-pill lauf-active">Lauf {{ r }}</span>
                {% else %}
                    <span class="lauf-pill">
                        <a href="{{ url_for('index', run=r, day=current_day) }}">Lauf {{ r }}</a>
                    </span>
                {% endif %}
            {% endfor %}
            <span class="lauf-pill"><a href="{{ url_for('new_run', day=current_day) }}">+ Neuer Lauf</a></span>
        </p>
    </div>

    <!-- Statistik + Smart Picks -->
    <div class="card">
        <h2>üëë Lauf {{ current_run }} ‚Äì Statistik</h2>
        <p>
            Insgesamt Picks: <strong>{{ stats.total_picks }}</strong><br>
            Verwendete Teams: <strong>{{ stats.used_teams_count }}/{{ stats.total_teams }}</strong>
        </p>

        <h3>Smart-Pick Empfehlungen f√ºr {{ current_day }}</h3>
        {% if smart_picks %}
            <ul>
                {% for s in smart_picks %}
                    <li style="margin-bottom:6px;">
                        {% if loop.first %}
                            <strong>Empfehlung:</strong>
                        {% else %}
                            Alternative:
                        {% endif %}
                        {{ s.team }}
                        {% if s.home %}
                            (Heim vs. {{ s.opponent }})
                        {% else %}
                            (Ausw√§rts bei {{ s.opponent }})
                        {% endif %}
                        ‚Äì Score: {{ s.score }}<br>
                        <span style="font-size:12px; color:#9ca3af;">
                            Gr√ºnde:
                            {{ ", ".join(s.reasons) }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="font-size: 12px; color: #9ca3af;">
                Keine Smart-Pick-Empfehlung verf√ºgbar
                (entweder keine Spiele, alle Teams von heute im Lauf schon verwendet
                oder du hast bereits einen Pick f√ºr heute gesetzt).
            </p>
        {% endif %}

        <h3>Teams in diesem Lauf</h3>
        <p style="font-size: 12px; color: #9ca3af;">
            Rot = bereits verwendet (nicht mehr verf√ºgbar), Gr√ºn = noch frei.
        </p>

        <div class="team-status-grid">
            {% for t in team_status %}
                <div class="team-status-card {% if t.used %}team-used{% else %}team-free{% endif %}">
                    {% if t.logo %}
                        <img src="{{ t.logo }}" alt="{{ t.name }} Logo">
                    {% endif %}
                    <div>{{ t.name }}</div>
                    {% if t.used %}
                        <div>‚ùå Verwendet</div>
                    {% else %}
                        <div>‚úÖ Frei</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Matchups + Picks -->
    <div class="card">
        <h2>Spiele & Picks am {{ current_day }} (Lauf {{ current_run }})</h2>

        {% if error %}
            <p class="error">{{ error }}</p>
        {% endif %}

        {% if game_cards %}
            <p style="font-size: 13px; color: #9ca3af;">
                W√§hle dein Team direkt im Matchup. Bereits verwendete Teams im aktuellen Lauf sind als
                <strong>Besetzt</strong> markiert.
            </p>

            <div class="matchup-grid">
                {% for g in game_cards %}
                    <div class="matchup-card">
                        <div class="matchup-row">

                            <!-- Visitor -->
                            <div class="matchup-team">
                                {% if g.visitor.logo %}
                                    <img src="{{ g.visitor.logo }}" alt="{{ g.visitor.name }} Logo">
                                {% else %}
                                    <div class="team-placeholder">{{ g.visitor.name }}</div>
                                {% endif %}
                                <div class="team-name">{{ g.visitor.name }}</div>

                                {% if g.visitor.picked %}
                                    <button class="btn-disabled" disabled>Besetzt</button>
                                {% else %}
                                    <form method="post" action="{{ url_for('index', run=current_run, day=current_day) }}">
                                        <input type="hidden" name="run" value="{{ current_run }}">
                                        <input type="hidden" name="day" value="{{ current_day }}">
                                        <input type="hidden" name="team" value="{{ g.visitor.name }}">
                                        <button type="submit">Team w√§hlen</button>
                                    </form>
                                {% endif %}
                            </div>

                            <!-- Separator -->
                            <div class="at">@</div>

                            <!-- Home -->
                            <div class="matchup-team">
                                {% if g.home.logo %}
                                    <img src="{{ g.home.logo }}" alt="{{ g.home.name }} Logo">
                                {% else %}
                                    <div class="team-placeholder">{{ g.home.name }}</div>
                                {% endif %}
                                <div class="team-name">{{ g.home.name }}</div>

                                {% if g.home.picked %}
                                    <button class="btn-disabled" disabled>Besetzt</button>
                                {% else %}
                                    <form method="post" action="{{ url_for('index', run=current_run, day=current_day) }}">
                                        <input type="hidden" name="run" value="{{ current_run }}">
                                        <input type="hidden" name="day" value="{{ current_day }}">
                                        <input type="hidden" name="team" value="{{ g.home.name }}">
                                        <button type="submit">Team w√§hlen</button>
                                    </form>
                                {% endif %}
                            </div>

                        </div>
                    </div>
                {% endfor %}
            </div>

        {% else %}
            <p>Keine Spiele an diesem Tag (oder API-Problem).</p>
        {% endif %}
    </div>

    <!-- Picks-Liste -->
    <div class="card">
        <h2>Deine Picks in Lauf {{ current_run }}</h2>

        {% if picks %}
            <table>
                <tr>
                    <th>#</th>
                    <th>Datum</th>
                    <th>Team</th>
                    <th>Aktionen</th>
                </tr>

                {% for p in picks %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ p.date }}</td>
                        <td>{{ p.team }}</td>
                        <td>
                            <form method="post" action="{{ url_for('delete_pick_route') }}" style="display:inline;">
                                <input type="hidden" name="index" value="{{ p.index }}">
                                <input type="hidden" name="run" value="{{ current_run }}">
                                <input type="hidden" name="day" value="{{ current_day }}">
                                <button class="btn-small" type="submit">L√∂schen</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </table>

            {% if picks|length >= 2 %}
                <h3>Picks tauschen</h3>
                <form method="post" action="{{ url_for('swap_picks_route') }}">
                    <input type="hidden" name="run" value="{{ current_run }}">
                    <input type="hidden" name="day" value="{{ current_day }}">
                    <label>Pick A:</label>
                    <select name="index_a">
                        {% for p in picks %}
                            <option value="{{ p.index }}">#{{ loop.index }} ‚Äì {{ p.date }} ‚Äì {{ p.team }}</option>
                        {% endfor %}
                    </select>

                    <label> Pick B:</label>
                    <select name="index_b">
                        {% for p in picks %}
                            <option value="{{ p.index }}">#{{ loop.index }} ‚Äì {{ p.date }} ‚Äì {{ p.team }}</option>
                        {% endfor %}
                    </select>

                    <button class="btn-small" type="submit">Tauschen</button>
                </form>
            {% endif %}

        {% else %}
            <p>Noch keine Picks vorhanden.</p>
        {% endif %}
    </div>

</body>
</html>
